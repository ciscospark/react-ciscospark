/* eslint-disable react/no-set-state,react/forbid-component-props,react/jsx-no-literals */
import React, {Component} from 'react';
import classNames from 'classnames';
import cookie from 'react-cookie';
import autobind from 'autobind-decorator';

import {Tabs, Tab} from 'material-ui/Tabs';
import RaisedButton from 'material-ui/RaisedButton';
import AppBar from 'material-ui/AppBar';
import Toggle from 'material-ui/Toggle';
import {Card, CardActions, CardTitle, CardText} from 'material-ui/Card';

import Highlight from 'react-highlight';
import 'highlight.js/styles/default.css';

import WidgetRecents from '@ciscospark/widget-recents';

import TokenInput from '../token-input';

import styles from './styles.css';

class DemoWidgetRecents extends Component {
  constructor(props) {
    super(props);
    const hasToken = !!cookie.load(`accessToken`);
    const accessToken = cookie.load(`accessToken`) || ``;
    this.state = {
      authenticate: false,
      displayToken: false,
      hasToken,
      accessToken,
      running: false
    };
  }

  shouldComponentUpdate() {
    return true;
  }

  @autobind
  handleSubmit(e) {
    e.preventDefault();
    cookie.save(`accessToken`, this.state.accessToken);
    this.setState({running: true});
  }

  @autobind
  handleAccessTokenChange(accessToken) {
    return this.setState({accessToken, hasToken: !!accessToken});
  }

  @autobind
  handleDisplayAccessTokenChange(e, displayToken) {
    return this.setState({displayToken});
  }

  createWidget(e) {
    e.preventDefault();
    return this.setState({running: true});
  }

  // eslint-disable-next-line complexity
  generateExampleCode(state) {
    const {accessToken, displayToken} = state;
    const displayedAccessToken = displayToken ? accessToken : `YOUR_ACCESS_TOKEN`;

    const reactCode = `import RecentsWidget from '@ciscospark/widget-recents';

<RecentsWidget accessToken="${displayedAccessToken}" />`;
    const inlineCode = `<div data-toggle="ciscospark-recents" data-access-token="${displayedAccessToken}" />`;
    const globalCode = `<div id="my-ciscospark-widget" />
<script>
  var widgetEl = document.getElementById('my-ciscospark-widget');
  // Init a new widget
  ciscospark.widget(widgetEl).recentsWidget({
    accessToken: '${displayedAccessToken}'
  });
</script>`;
    return {
      globalCode,
      inlineCode,
      reactCode
    };
  }

  render() {
    const loadButtonEnabled = this.state.accessToken;
    const {globalCode, inlineCode, reactCode} = this.generateExampleCode(this.state);
    if (this.state.running) {
      return (
        <div>
          <AppBar title="Cisco Spark Recents Widget" />
          <div className={classNames(`ciscospark-widget-component-container`, styles.widgetComponentContainer)}>
            <WidgetRecents
              accessToken={this.state.accessToken}
            />
          </div>
        </div>
      );
    }
    return (
      <div>
        <AppBar title="Cisco Spark Recents Widget" />
        <div className={classNames(`ciscospark-demo-wrapper`, styles.demoWrapper)}>
          <Card initiallyExpanded style={{margin: `10px`}}>
            <CardTitle
              actAsExpander
              showExpandableButton
              title="Cisco Spark Recents Widget Demo"
            />
            <CardText expandable>
              <p>
              The Spark Recents widget allows developers to easily incorporate Cisco Spark Recents list and events into an application.
              </p>
              <p>
              This widget handles coordination between your application and the Spark APIs, and provides components of the Spark recents list experience without having to build all of the front end UI yourself.
              </p>
              <p>
              Our widget is built using <a href="https://github.com/facebook/react">React</a>, <a href="https://github.com/reactjs/redux">Redux</a>, and the <a href="https://github.com/ciscospark/spark-js-sdk">Spark Javascript SDK </a>.
              </p>
            </CardText>
            <CardActions expandable>
              <RaisedButton
                disabled={!loadButtonEnabled}
                label={`Open Embedded Widget`}
                onClick={this.handleSubmit}
                primary
              />
            </CardActions>
          </Card>
          <TokenInput onLogin={this.handleAccessTokenChange} token={this.state.accessToken} />
          <Card initiallyExpanded style={{margin: `10px`}}>
            <CardTitle
              actAsExpander
              showExpandableButton
              subtitle="Cisco Spark Recents Widget can be implemented multiple ways."
              title="Widget Example Code"
            />
            <CardText expandable>
              <div className={classNames(styles.example)}>
                <Tabs>
                  <Tab label={`React Component`}>
                    <div className={classNames(`ciscospark-example-code`, styles.exampleCode)}>
                      <Highlight>
                        {reactCode}
                      </Highlight>
                    </div>
                  </Tab>
                  <Tab label={`Inline Mode`}>
                    <div className={classNames(`ciscospark-example-code`, styles.exampleCode)}>
                      <Highlight>
                        {inlineCode}
                      </Highlight>
                    </div>
                  </Tab>
                  <Tab label={`Global Mode`}>
                    <div className={classNames(`ciscospark-example-code`, styles.exampleCode)}>
                      <Highlight>
                        {globalCode}
                      </Highlight>
                    </div>
                  </Tab>
                </Tabs>
                <div className={classNames(`ciscospark-toggle`, styles.toggle)}>
                  <div>
                    <Toggle
                      label="Display Access Token"
                      labelPosition="right"
                      onToggle={this.handleDisplayAccessTokenChange}
                    />
                  </div>
                </div>
              </div>
            </CardText>
          </Card>
        </div>
      </div>
    );
  }
}

DemoWidgetRecents.title = `Widget Recents`;
DemoWidgetRecents.path = `/widget-recents-demo`;

export default DemoWidgetRecents;
