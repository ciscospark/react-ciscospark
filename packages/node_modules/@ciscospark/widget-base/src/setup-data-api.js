import _ from 'lodash';

export default function loadWidgets() {
  const widgets = document.querySelectorAll(`[data-toggle^="ciscospark-"]`);
  for (const widget of widgets) {
    // find what widget this is
    const widgetName = _.camelCase(widget.getAttribute(`data-toggle`).replace(`ciscospark-`, ``));
    const widgetInit = window.ciscospark.widget(widget)[`${widgetName}Widget`];
    if (typeof widgetInit === `function`) {
      // grab all data attributes that are not data-toggle
      const props = getDataAttributes(widget);
      widgetInit(props);
    }
  }
}

function getDataAttributes(el) {
  const data = {};
  if (el) {
    for (const a of el.attributes) {
      const name = a.name;
      const val = a.value;
      if (name.startsWith(`data-`) && name !== `data-toggle`) {
        data[_.camelCase(name.replace(`data-`, ``))] = val;
      }
    }
  }
  return data;
}


document.addEventListener(`DOMContentLoaded`, loadWidgets, false);
