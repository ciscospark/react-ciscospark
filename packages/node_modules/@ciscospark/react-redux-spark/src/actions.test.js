/* eslint max-nested-callbacks: ["error", 3] */
import createSpark from './fixtures/spark';
import {createMockStore} from './__mocks__/spark-store';

import {
  UPDATE_SPARK_STATUS,
  updateSparkStatus,
  registerDevice
} from './actions';

const ACCESS_TOKEN = process.env.CISCOSPARK_ACCESS_TOKEN;

describe(`actions`, () => {
  it(`should create an action to update spark status`, () => {
    const newState = {
      registered: true,
      authenticated: true
    };

    const expectedAction = {
      type: UPDATE_SPARK_STATUS,
      payload: {
        status: newState
      }
    };

    expect(updateSparkStatus(newState)).toEqual(expectedAction);
  });
});

describe(`sdk actions`, () => {
  let mockStore;

  beforeEach(() => {
    mockStore = createMockStore();
  });

  it(`should register this device with spark`, () => {
    const spark = createSpark(ACCESS_TOKEN);
    const expectedActions = [{
      type: UPDATE_SPARK_STATUS,
      payload: {
        status: {registering: true}
      }
    }, {
      type: UPDATE_SPARK_STATUS,
      payload: {
        status: {registering: false, registered: true}
      }
    }];

    return mockStore.dispatch(registerDevice(spark))
      .then(() => {
        expect(mockStore.getActions()).toEqual(expectedActions);
      });
  });
});
